openapi: 3.0.3
info:
  title: Report Service API
  description: API for generating transaction reports and analytics
  version: 1.0.0

servers:
  - url: http://localhost:8086
    description: Local development server

paths:
  /api/reports/daily-avg:
    get:
      summary: Get daily average balance
      description: Calculate the daily average balance for a customer in a specific period
      operationId: getDailyAverage
      tags:
        - Reports
      parameters:
        - name: customerId
          in: query
          required: true
          description: Customer identifier
          schema:
            type: string
            example: "CUST001"
        - name: period
          in: query
          required: true
          description: Period in format yyyyMM
          schema:
            type: string
            pattern: '^\d{6}$'
            example: "202512"
      responses:
        '200':
          description: Daily average calculated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailyAvgResponse'
        '404':
          description: No transactions found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/reports/commissions:
    get:
      summary: Get average commissions
      description: Calculate the average commission for a customer in a specific period
      operationId: getAverageCommissions
      tags:
        - Reports
      parameters:
        - name: customerId
          in: query
          required: true
          description: Customer identifier
          schema:
            type: string
            example: "CUST001"
        - name: period
          in: query
          required: true
          description: Period in format yyyyMM
          schema:
            type: string
            pattern: '^\d{6}$'
            example: "202512"
      responses:
        '200':
          description: Average commission calculated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommissionAvgResponse'
        '404':
          description: No transactions with commissions found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/reports/customer-products/{customerId}:
    get:
      summary: Get all products for a customer
      description: Retrieve consolidated information about all products (accounts, credits, debit cards) for a specific customer
      operationId: getCustomerProducts
      tags:
        - Reports
      parameters:
        - name: customerId
          in: path
          required: true
          description: Customer identifier
          schema:
            type: string
            example: "CUST001"
      responses:
        '200':
          description: Customer products retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerProductsResponse'
        '400':
          description: Invalid customer ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/reports/customer-products-transactions/{customerId}:
    get:
      summary: Get customer products with their transactions
      description: Retrieve all products with their completed transactions for a specific customer
      operationId: getCustomerProductsWithTransactions
      tags:
        - Reports
      parameters:
        - name: customerId
          in: path
          required: true
          description: Customer identifier
          schema:
            type: string
            example: "693e644fbb761350f3b95207"
      responses:
        '200':
          description: Customer products with transactions retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerProductsTransactionsResponse'
        '400':
          description: Invalid customer ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    DailyAvgResponse:
      type: object
      required:
        - accountId
        - avgDaily
      properties:
        accountId:
          type: string
          description: Account identifier
          example: "69409212022d8e3298e1072f"
        avgDaily:
          type: number
          format: double
          description: Daily average balance
          example: 4800.00
          minimum: 0

    CommissionAvgResponse:
      type: object
      required:
        - accountId
        - avgCommissions
      properties:
        accountId:
          type: string
          description: Account identifier
          example: "69409212022d8e3298e1072f"
        avgCommissions:
          type: number
          format: double
          description: Average commission amount
          example: 12.50
          minimum: 0

    CustomerProductsResponse:
      type: object
      required:
        - customerId
        - hasProducts
        - accounts
        - credits
        - debitCards
        - summary
      properties:
        customerId:
          type: string
          description: Customer identifier
          example: "CUST001"
        hasProducts:
          type: boolean
          description: Indicates if customer has any products
          example: true
        accounts:
          type: array
          description: List of customer accounts
          items:
            $ref: '#/components/schemas/AccountSummary'
        credits:
          type: array
          description: List of customer credits
          items:
            $ref: '#/components/schemas/CreditSummary'
        debitCards:
          type: array
          description: List of customer debit cards
          items:
            $ref: '#/components/schemas/DebitCardSummary'
        summary:
          $ref: '#/components/schemas/ProductsSummary'

    AccountSummary:
      type: object
      required:
        - id
        - accountNumber
        - accountType
        - balance
        - active
      properties:
        id:
          type: string
          description: Account identifier
          example: "69409212022d8e3298e1072f"
        accountNumber:
          type: string
          description: Account number
          example: "1234567890"
        accountType:
          type: string
          description: Type of account
          enum:
            - SAVING
            - CHECKING
            - FIXED_TERM
          example: "SAVING"
        balance:
          type: number
          format: double
          description: Current balance
          example: 5000.00
        maintenanceFee:
          type: number
          format: double
          description: Monthly maintenance fee
          example: 10.00
        active:
          type: boolean
          description: Account status
          example: true
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: "2025-01-01T10:00:00Z"

    CreditSummary:
      type: object
      required:
        - id
        - creditNumber
        - creditType
        - creditLimit
        - availableCredit
        - active
      properties:
        id:
          type: string
          description: Credit identifier
          example: "69409212022d8e3298e1073f"
        creditNumber:
          type: string
          description: Credit number
          example: "CC-9876543210"
        creditType:
          type: string
          description: Type of credit
          enum:
            - PERSONAL
            - BUSINESS
            - CREDIT_CARD
            - BUSINESS_LOAN
            - PERSONAL_LOAN
          example: "CREDIT_CARD"
        creditLimit:
          type: number
          format: double
          description: Credit limit
          example: 10000.00
        balance:
          type: number
          format: double
          description: Current debt balance
          example: 2500.00
        availableCredit:
          type: number
          format: double
          description: Available credit
          example: 7500.00
        interestRate:
          type: number
          format: double
          description: Interest rate
          example: 18.5
        active:
          type: boolean
          description: Credit status
          example: true
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: "2025-01-01T10:00:00Z"

    DebitCardSummary:
      type: object
      required:
        - id
        - cardNumber
        - primaryAccountId
        - associatedAccountsCount
        - active
      properties:
        id:
          type: string
          description: Debit card identifier
          example: "69409212022d8e3298e1074f"
        cardNumber:
          type: string
          description: Masked card number
          example: "****1234"
        primaryAccountId:
          type: string
          description: Primary account linked to the card
          example: "69409212022d8e3298e1072f"
        associatedAccountsCount:
          type: integer
          description: Number of associated accounts
          example: 2
        active:
          type: boolean
          description: Card status
          example: true
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: "2025-01-01T10:00:00Z"

    ProductsSummary:
      type: object
      required:
        - totalAccounts
        - totalCredits
        - totalDebitCards
        - totalProducts
      properties:
        totalAccounts:
          type: integer
          description: Total number of accounts
          example: 1
        totalCredits:
          type: integer
          description: Total number of credits
          example: 1
        totalDebitCards:
          type: integer
          description: Total number of debit cards
          example: 1
        totalProducts:
          type: integer
          description: Total number of products
          example: 3

    CustomerProductsTransactionsResponse:
      type: object
      required:
        - customerId
        - hasProducts
        - accounts
        - credits
        - debitCards
        - summary
      properties:
        customerId:
          type: string
          description: Customer identifier
          example: "693e644fbb761350f3b95207"
        hasProducts:
          type: boolean
          description: Indicates if customer has any products
          example: true
        accounts:
          type: array
          description: List of customer accounts with transactions
          items:
            $ref: '#/components/schemas/AccountWithTransactions'
        credits:
          type: array
          description: List of customer credits with transactions
          items:
            $ref: '#/components/schemas/CreditWithTransactions'
        debitCards:
          type: array
          description: List of customer debit cards
          items:
            $ref: '#/components/schemas/DebitCardSummary'
        summary:
          $ref: '#/components/schemas/ProductsTransactionsSummary'

    AccountWithTransactions:
      type: object
      required:
        - id
        - accountNumber
        - accountType
        - balance
        - active
        - transactions
      properties:
        id:
          type: string
          example: "693f39edcbfd0c23a40df3df"
        accountNumber:
          type: string
          example: "ACC-34FF9D932E"
        accountType:
          type: string
          enum:
            - SAVING
            - CHECKING
            - FIXED_TERM
          example: "SAVING"
        balance:
          type: number
          format: double
          example: 856.0
        maintenanceFee:
          type: number
          format: double
          example: 0.0
        active:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-12-14T17:27:57.332Z"
        transactions:
          type: array
          items:
            $ref: '#/components/schemas/TransactionSummary'

    CreditWithTransactions:
      type: object
      required:
        - id
        - creditNumber
        - creditType
        - creditLimit
        - availableCredit
        - active
        - transactions
      properties:
        id:
          type: string
          example: "693f558877f37725ff2d903f"
        creditNumber:
          type: string
          example: "CRD-BE9059E434"
        creditType:
          type: string
          enum:
            - PERSONAL
            - BUSINESS
            - CREDIT_CARD
            - PERSONAL_LOAN
            - BUSINESS_LOAN
          example: "PERSONAL_LOAN"
        creditLimit:
          type: number
          format: double
          example: 10000.0
        balance:
          type: number
          format: double
          example: 0.0
        availableCredit:
          type: number
          format: double
          example: 10000.0
        interestRate:
          type: number
          format: double
          example: 5.5
        active:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-12-14T19:25:44.466Z"
        transactions:
          type: array
          items:
            $ref: '#/components/schemas/TransactionSummary'

    TransactionSummary:
      type: object
      required:
        - id
        - transactionType
        - amount
        - status
        - createdAt
      properties:
        id:
          type: string
          example: "trans001"
        transactionType:
          type: string
          example: "DEPOSIT"
        amount:
          type: number
          format: double
          example: 500.0
        status:
          type: string
          example: "COMPLETED"
        description:
          type: string
          example: "Deposit to savings account"
        balanceAfter:
          type: number
          format: double
          example: 1500.0
        commission:
          type: number
          format: double
          example: 2.0
        createdAt:
          type: string
          format: date-time
          example: "2025-12-14T10:30:00Z"
        period:
          type: string
          example: "202512"

    ProductsTransactionsSummary:
      type: object
      required:
        - totalAccounts
        - totalCredits
        - totalDebitCards
        - totalProducts
        - totalTransactions
        - totalAccountTransactions
        - totalCreditTransactions
      properties:
        totalAccounts:
          type: integer
          example: 2
        totalCredits:
          type: integer
          example: 2
        totalDebitCards:
          type: integer
          example: 1
        totalProducts:
          type: integer
          example: 5
        totalTransactions:
          type: integer
          example: 45
        totalAccountTransactions:
          type: integer
          example: 30
        totalCreditTransactions:
          type: integer
          example: 15

    ErrorResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          example: "2025-12-29T10:30:00Z"
        status:
          type: integer
          example: 404
        error:
          type: string
          example: "Not Found"
        message:
          type: string
          example: "No transactions found for customer in period"
        path:
          type: string
          example: "/api/reports/daily-avg"